<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Page 13 | keen blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta name="description" content="techblog">
<meta property="og:type" content="website">
<meta property="og:title" content="keen blog">
<meta property="og:url" content="http://keen.devpools.kr/page/13/index.html">
<meta property="og:site_name" content="keen blog">
<meta property="og:description" content="techblog">
<meta property="og:locale" content="ko">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="keen blog">
<meta name="twitter:description" content="techblog">
  
    <link rel="alternate" href="/atom.xml" title="keen blog" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/favicon.ico">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
    
  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Yanone+Kaffeesatz%3A200%2C300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">

  <link rel="stylesheet" id="athemes-headings-fonts-css" href="//fonts.googleapis.com/css?family=Oswald%3A300%2C400%2C700&amp;ver=4.6.1" type="text/css" media="all">
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >
  <link rel="stylesheet" href="/css/fashion.css" >
  <link rel="stylesheet" href="/css/glyphs.css" >

</head>



  <body>


  
  
  <div class="site-header-image">
    <img id="originBg" width="100%" alt="Hike News" src="">
  </div>

  <div id="header-blur" class="site-header-image blur" style="position: absolute; top:0; height: 207px; min-height: 207px; min-width: 100%;">
    <img id="blurBg" width="100%" style="top: 96%" alt="Hike News" src="">
  </div>

  <script>
        var imgUrls = "images/storm.png".split(",");
        var random = Math.floor((Math.random() * imgUrls.length ));
        if (imgUrls[random].startsWith('http') || imgUrls[random].indexOf('://') >= 0) {
          document.getElementById("originBg").src=imgUrls[random];
          document.getElementById("blurBg").src=imgUrls[random];
        } else {
          document.getElementById("originBg").src='/' + imgUrls[random];
          document.getElementById("blurBg").src='/' + imgUrls[random];
        }
    </script>




<header id="allheader" class="site-header" role="banner" 
   style="width: 100%; position: absolute; top:0; background: rgba(255,255,255,.8);"  >
  <div class="clearfix container">
      <div class="site-branding">

          <h1 class="site-title">
            
              <a href="/" title="keen blog" rel="home"> keen blog </a>
            
          </h1>
          
          
            <div class="site-description">techblog</div>
          
            
          <nav id="main-navigation" class="main-navigation" role="navigation">
            <a class="nav-open">Menu</a>
            <a class="nav-close">Close</a>

            <div class="clearfix sf-menu">
              <ul id="main-nav" class="menu sf-js-enabled sf-arrows"  style="touch-action: pan-y;">
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/">Home</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/archives">Archives</a> </li>
                    
                      <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1663"> <a class="" href="/about">About</a> </li>
                    
              </ul>
            </div>
          </nav>

      </div>
  </div>
</header>


  <div id="container">
    <div id="wrap">
            
      <div id="content" class="outer">
        
          <section id="main">
  
    <article id="post-[2016-11-07 20:01:47]서버리스 아키텍처 소셜미디어 개발기 4편"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2016/11/07/[2016-11-07 20:01:47]서버리스 아키텍처 소셜미디어 개발기 4편/">서버리스 아키텍처 소셜미디어 개발기 4편</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2016/11/07/[2016-11-07 20:01:47]서버리스 아키텍처 소셜미디어 개발기 4편/" class="article-date">
	  <time datetime="2016-11-07T11:01:47.000Z" itemprop="datePublished">11월 7, 2016</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="서버리스-아키텍처-소셜미디어-개발기-4편"><a href="#서버리스-아키텍처-소셜미디어-개발기-4편" class="headerlink" title="서버리스 아키텍처 소셜미디어 개발기 4편"></a>서버리스 아키텍처 소셜미디어 개발기 4편</h3><p>지난 편에서는 Editor 에서 데이타를 어떻게 나눌지살펴보았고 Firebase 기초, 테스트 코드를 작성해 보았습니다. 이번에는 그 기반으로 어떻게 실제로 데이타를 입력하고 리스트를 작성하는지 확인해 보겠습니다.</p>
<p><a href="https://techstory.shma.so/%EC%84%9C%EB%B2%84%EB%A6%AC%EC%8A%A4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98-%EC%86%8C%EC%85%9C%EB%AF%B8%EB%94%94%EC%96%B4-%EA%B0%9C%EB%B0%9C%EA%B8%B0-3%ED%8E%B8-4820c96df984" title="https://techstory.shma.so/%EC%84%9C%EB%B2%84%EB%A6%AC%EC%8A%A4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98-%EC%86%8C%EC%85%9C%EB%AF%B8%EB%94%94%EC%96%B4-%EA%B0%9C%EB%B0%9C%EA%B8%B0-3%ED%8E%B8-4820c96df984" target="_blank" rel="external"><strong>서버리스 아키텍처 소셜미디어 개발기 3편</strong><br>_지난 번 글에서는 기초적인 편집기를 만드는 작업을 했습니다. 사용자 스토리에 기반한 하나의 편집기와 버튼으로만 구현할 수 있도록 화면을 구성했구요._techstory.shma.so</a><a href="https://techstory.shma.so/%EC%84%9C%EB%B2%84%EB%A6%AC%EC%8A%A4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98-%EC%86%8C%EC%85%9C%EB%AF%B8%EB%94%94%EC%96%B4-%EA%B0%9C%EB%B0%9C%EA%B8%B0-3%ED%8E%B8-4820c96df984" target="_blank" rel="external"></a></p>
<blockquote>
<p>2. 김개발이 사이트를 방문해서 자신이 어제 유심하게 읽은 글을 올릴 수 있다. 이렇게 하면 다른 사람들이 볼 수 있다.<br>* 에디터 창은 하나만 있고 거기서 글을 작성하고 업로드 하면 글이 외부 클라우드 공간에 저장이 된다.<br>* 아무런 내용도 김개발이 입력하지 않으면 업로드하지 않는다.( 버튼이 눌러지지 않는다. )<br>3. 김개발이 작성한 글이 목록으로 보여진다. 이렇게 함으로써 다른 사람들이 목록을 확인할 수 있다.</p>
</blockquote>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*XsSPffTzyvwuC1S91xBEQg.png" alt="">cloud data</p>
<h4 id="1-Firebase-DAO-Data-Access-Object-만들기"><a href="#1-Firebase-DAO-Data-Access-Object-만들기" class="headerlink" title="1. Firebase DAO(Data Access Object) 만들기"></a>1. Firebase DAO(Data Access Object) 만들기</h4><p>JavaScript라서 DAO패턴을 좋아하지는 않지만 굳이 이해를 돕기 위해 DAO라는 이름을 명명하고 작업을 하겠습니다.</p>
<p>(인터페이스를 만들고 Implementation 소스를 만드는 작업까지는 굳이 하지 않겠습니다.)</p>
<p><strong>테스트 코드를 짜 보자.</strong></p>
<p>일단 Mocking을 할 데이터를 만들어야 하겠죠.</p>
<p>__tests__ 폴더 밑에 CloudDao.js 를 만듭니다.</p>
<pre><code>//CloudDao.js 파일  
var article = {  
user : &quot;Genji&quot;,  
content : &quot;겐지가 함께한다.&quot;,  
urls:\[{  
url : &quot;[https://namu.wiki/w/%EA%B2%90%EC%A7%80(%EC%98%A4%EB%B2%84%EC%9B%8C%EC%B9%98)][anchor2]&quot;,  
title:&quot;겐지(오버워치)&quot;,  
description : &quot;블리자드 엔터테인먼트 사의 FPS 게임 오버워치의 영웅.기계가 되어버린 몸을 받아들여 내면의 평화를 찾은 강력한 사이보그 닌자.&quot;,  
imageUrl : &quot;[https://image-proxy.namuwikiusercontent.com/r/https%3A%2F%2Fd1u1mce87gyfbn.cloudfront.net%2Fmedia%2Fartwork%2Fgenji-concept.jpg][anchor3]&quot;,  
imgWidth: 640,  
imgHeight : 480,  
thumbnailUrl : &quot;[https://image-proxy.namuwikiusercontent.com/r/http%3A%2F%2Fi66.tinypic.com%2F10mpje9.jpg][anchor4]&quot; ,  
thumbnailWidth : 80,  
thumbnailHeight :80  
}\]  
}
</code></pre><p>Mocking을 위한 데이터를 만들어 보겠습니다. 이 데이터가 잘 입력이 되고 수정이 되고 삭제가 되면서 리스트를 확인하는 작업을 해 보겠습니다.</p>
<p>firebase를 사용하기 위해서 모듈을 설치합니다. 이미 설치된 모듈이 아니기 때문에 다음의 명령어를 사용합니다.</p>
<pre><code>$npm install firebase --save
</code></pre><p><strong>DAO 만들기</strong></p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*37MgCskWYkYLPyTbX0pk4w.png" alt="">if code is coffee</p>
<p>자 이제 DAO를 어떻게 만들면 좋을까요?</p>
<p>먼저 DAO에는 입력, 수정, 삭제, 조회(insert, update, delete, list)는 기본적으로 들어갈 것이고,한 건 검색을 위한 getArticle이 필요할 것입니다. 일단 입력에 관한 유저 스토리 이지만 DAO는 한꺼번에 작성할 수 있는 것은 먼저 작성해 보도록 하겠습니다.</p>
<p>사용자 스토리의 기본 중 하나는 <strong>확인할 수 있어야 한다</strong> 인데, 입력이 되면 조회를 할 수 있어야 하기 때문입니다.</p>
<blockquote>
<p>! 여기서 잠깐 !<br>사용자 스토리는 INVEST를 기반으로 하는데<br>Independent : 독립적이어야 한다<br>Negotiable : 조절 가능해야 한다<br>Valuable : 사용자에게 가치가 있어야 한다.<br>Estimatable : 측정가능해야 한다<br>Small : 작아야 한다<br>Testable : 테스트 가능해야 한다.<br>우리가 정해 놓은 사용자 스토리를 위에 맞춰 변경하는 작업도 중간 중간 이루어 질 것입니다.</p>
</blockquote>
<p>일단 입력을 위한 테스트 코드를 아래와 같이 작성해 보겠습니다.</p>
<pre><code>it(&apos;upload article&apos;,function(){  
let inserted = dao.insert( article );  
// 입력이 되었는지 key 값을 가지고 검색해서 확인  
dao.getArticle(key).on(&apos;value&apos;,(snapShot)=\&gt;{  
//키 값이 같은지 테스트 케이스 작성  
expect(snapShot.key).toEqual(key);  
});  
return inserted;  
});
</code></pre><p>자, 이제 npm test를 실행하면 되는데, 다음의 셋팅을 하지 않으면 데이터 값이 로딩이 되지 않을 것입니다.<br>firebase는 인증 시스템을 갖고 있는데, 일단 그림과 같이 anonymous가 입력할 수 있도록 해 두고 이후 인증관련 모듈을 같이 붙인 후에 셋팅을 바꿔보도록 하겠습니다.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*Co56vTxmYqNHebg6cbpTIg.jpeg" alt="">그림1</p>
<p>StandUp-> Database -> 규칙 메뉴를 따라가면 될 듯 합니다.</p>
<pre><code>{  
&quot;rules&quot;: {  
&quot;.read&quot;: true,  
&quot;.write&quot;: true  
}  
}
</code></pre><p>자 이제 npm test 를 실행하고 나면</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*AznUyNRBj7jXOF1SDCStrA.jpeg" alt="">그림2</p>
<p>아래와 같은 결과와 함께 외부 firebase 에 저장이 됩니다.</p>
<p>firebase 웹 콘솔에서 확인해 봐야겠죠?</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*c6rdZGLFcp3fVwGfBS7TEA.jpeg" alt="">그림3</p>
<p>그림과 같이 firebase 웹 콘솔에서 Database 의 데이터 탭에서 방금 올린 데이터를 확인할 수 있습니다.</p>
<p>이렇게만 데이터를 쌓아도 되지만 개인화 서비스를 위해 username 기반으로 데이터를 쌓이도록 변경해 보겠습니다.</p>
<p>이런 경우는 key값을 먼저 만들고 같은 key를 가지는 posts와 user-post 데이터 베이스를 만들어야 하는 관계로 update 함수를 작성하도록 하겠습니다. 아직 user 정보를 어떻게 가지고 올지 결정하지 않았으므로 똑같이 genji 폴더에만 작성하도록 하겠습니다.</p>
<p>해당 관련된 테스트 코드는 다음과 같습니다.</p>
<pre><code>it(&apos;upload article and edit and delete&apos;,function(){  
//공통 키값  
let key = dao.newKey();  
//입력  
var updated = dao.update( key, article1 );  
dao.getArticle(key).on(&apos;value&apos;,(snapShot)=\&gt;{  
//같은 값이 들어 갔는지 확인  
expect(snapShot.key).toEqual(key);  
//수정  
dao.update(key, article2);  
//삭제. 데이터의 확인을 위해서는 주석 처리.  
dao.remove(key);  
});  
return updated;  
});
</code></pre><p>먼저 key 값을 공통으로 만들고, key 값을 기준으로 입력, 수정, 삭제할 수 있습니다.</p>
<p>FirebaseDao 전체 소스는 다음과 같습니다.</p>
<pre><code>import firebase from &apos;firebase&apos;;  
/\*  
\* initializeFirebaseApp  
\*/

export default class FirebaseDao {  
constructor(config){  
firebase.initializeApp(config);  
}  
//더 이상 입력에 사용하지 않습니다.  
insert(postData){  
return firebase.database().ref().child(&apos;posts&apos;).push(postData);  
}  
// 수정  
update(key,postData){  
var updates = {};  
updates\[&apos;/posts/&apos; + key\] = postData;  
updates\[&apos;/user-posts/genji/&apos; + key\] = postData;  
return firebase.database().ref().update(updates);  
}  
// 삭제, delete는 예약어 이므로 remove를 사용  
remove(key){  
firebase.database().ref(&apos;/posts/&apos;).child(key).remove();  
return firebase.database().ref(&apos;/user-posts/genji/&apos;).child(key).remove();  
}  
//database에 걸린 이벤트를 종료  
off(){  
return firebase.database().ref().off();  
}  
//새로 빈 데이터를 만들고 key값만 return  
newKey(){  
return firebase.database().ref().child(&apos;posts&apos;).push().key;  
}  
//한개의 글을 얻어 온다.  
getArticle(key){  
return firebase.database().ref(&apos;/posts/&apos; + key);  
}  
}
</code></pre><p>자 이제 테스트 코드 하나로 입력-> 수정 -> 삭제를 하는 코드베이스가 완성되었습니다.</p>
<h4 id="2-사용자-스토리2-—-입력하기"><a href="#2-사용자-스토리2-—-입력하기" class="headerlink" title="2. 사용자 스토리2 — 입력하기"></a>2. 사용자 스토리2 — 입력하기</h4><p><img src="https://cdn-images-1.medium.com/max/1600/1*tCRiy6x6RFlpyLNOxMLA9A.png" alt=""></p>
<pre><code>업로드 하면 글이 외부 클라우드 공간에 저장이 된다.
</code></pre><p>부분을 위한 테스트 코드와 DAO를 완성했으니 프레젠테이션 레이어와 결합해 보도록 하겠습니다.</p>
<p>지금 에디터에서 글을 쓰고 스탠드업! 버튼을 누를 경우에</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*PO1wRepSjhEEzYTOB5nDmQ.jpeg" alt="">그림4</p>
<p>이루어지는 이벤트는 다음과 같습니다.</p>
<pre><code>&lt;button className=&quot;upload&quot;  
disabled={!this.hasValue(this.state.content)}  
onClick={this.handleSubmit}\&gt;&lt;span\&gt;스탠드업!&lt;/span\&gt;&lt;/button\&gt;
</code></pre><p>이 handleSubmit을 어떻게 작성하면 좋을까요? onClick 이벤트가 호출이 되는 시점부터는 데이터의 영역인데 데이터의 흐름은 한군데서 파악하는 것이 개발을 용이하게 합니다. 게다가 우리는 firebase 처럼 우리가 직접 컨트롤하지 않는 데이터의 흐름을 가지고 있기 때문에 내부의 데이터의 흐름은 App.js 같은 애플리케이션 진입점으로 위임하는 편이 현명합니다.</p>
<p>그럼 이 “데이터”의 기본 단위가 될 Article 을 우리는 미리 정의했었습니다. 처음에 Mocking을 위한 데이타라고 한 부분의 article을 반환하는 임시 파일을 만들겠습니다. 이렇게 하는 이유는 테스트의 완결성을 위해서입니다.</p>
<p>Article.js 라는 파일을 src 폴더 아래에 만들고 테스트 코드는 아래와 같이 작성합니다.</p>
<pre><code>import Article from &apos;../Article&apos;;  
var article1 = Article();  
it(&apos;Object assign&apos;, function(){  
var article2 = Object.assign({},article1);  
article2.user = &quot;Genji&quot;;  
article2.content = &quot;다음&quot;;  
article2.urls\[0\].url = &quot;[http://www.daum.net][anchor5]&quot;;  
//article1의 값이 잘 전달되었는지 확인.  
expect(article1.urls\[0\].imgWidth).toEqual(article2.urls\[0\].imgWidth);  
})
</code></pre><p>왜 이런 작업을 했을까요? 간단히 말씀 드리면 4일차 작업에는 url로 카드를 만들 때 외부에서 URL에 해당하는 메타정보(title, description, thumbnail image)등의 작업을 하지 않기 때문입니다. 그래서 일단은 더미 작업을 하고 이 부분을 카드를 가져오는 방법으로 전환하는 과정을 5일차에 진행하려고 하기 때문입니다.</p>
<p>그런 과정중에 Article의 URL 이외의 부분은 자동으로 채우게 하도록Mocking 데이타를 활용해서 보도록 하는 것입니다.</p>
<p>자 이제 다시 에디터로 돌아가겠습니다.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*5o8unzS6sekGXi1NK5BoxA.jpeg" alt="">그림5</p>
<p>Editor 안의 state는 보시다시피 embedlyUrl, content 두가지를 설정해 두었습니다.<br>이 embedlyUrl을 App.js에게 값을 전달해 이후 list 컴포넌트를 만드는 사용자 스토리까지 전달되기 전까지가 지금의 해결 과제입니다.</p>
<p>[그림 5] 에 묘사가 되어 있듯이 Editor.js 의 handleSubmit은 props 속성으로 App.js와 연결되어 있습니다. handleSubmit event는 App.js의 submit 을 가리키게 되어 있는 것이죠.</p>
<p>그래서 submit 은 Article을 변수로 받아서 firebase 에 저장하는 역할을 하면 됩니다.</p>
<p>App.js의 submit을 아래와 같이 변경해 줍니다.</p>
<pre><code>import FirebaseDao from &apos;./FirebaseDao&apos;  
import config from &apos;./config&apos;  
(중략)  
class App extends Component {  
//중략  
constructor(){  
super();  
this.dao = new FirebaseDao(config);  
this.submit = this.submit.bind(this);  
}  
submit(article){  
if(article){  
let key = this.dao.newKey();  
let updated = this.dao.update( key, article );  
return updated;  
}  
}  
//후략  
}
</code></pre><p>Editor.js 파일은 아까 언급한 Article.js 를 이용해 handleSubmit을 아래와 같이 작업해 줍니다.</p>
<pre><code>handleSubmit(event){  
let article = Object.assign({}, Article());  
article.user = &quot;Genji&quot;;  
article.content = this.state.content;  
article.urls\[0\].url = this.state.embedlyUrl;  
this.props.submit(article);  
}
</code></pre><p><img src="https://cdn-images-1.medium.com/max/1600/1*nnNkaY52MqIkTrKOLOAtqg.jpeg" alt="">그림6</p>
<p>[그림6]과 같이 작성을 하고 업로드를 하면</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*u-ULofFcX5OO9FTbXaNgfQ.jpeg" alt="">그림7</p>
<p>훌륭하게 값이 들어간 것을 확인할 수 있습니다.</p>
<p><strong>이제 입력한 목록만 간단하게 보여지는 것을 보고는 마무리 하겠습니다.</strong></p>
<p>FirebaseDao에 list에 관련된 함수를 추가해 봅시다.</p>
<p>일단 테스트 코드를 아래와 같이 작성해 봅니다.</p>
<pre><code>it(&apos;list article&apos;, function(){  
dao.list(25).once(&apos;value&apos;,(dataSnapshots)=\&gt;{  
dataSnapshots.forEach((dataSnapshot)=\&gt;{  
keys.push(dataSnapshot.key);  
var article = dataSnapshot.val();  
expect(article.user).toEqual(&quot;Genji&quot;);  
})  
});  
})
</code></pre><p>DAO 에서 25개까지의 결과만 가지고 와서 데이타의 값을 비교하는 형태이고 콜백함수는 firebase 문서에서 참조해서 작성했습니다.</p>
<pre><code>list(pagesize){  
return firebase.database().ref(&apos;/posts/&apos;)  
.orderByKey().limitToLast(pagesize);  
}
</code></pre><p>위와 같이 작성하면 npm test를 통해 값이 훌륭하게 가져와 있는지 확인할 수 있습니다.</p>
<p>이제 App.js 파일을 고쳐 보겠습니다.</p>
<p>React 컴포넌트의 생명주기에서 mounting 과정은 [그림8] 과 같습니다.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*EMFoazxLNSoxe_MeFEnVuQ.jpeg" alt="">그림8</p>
<p>componentWillMount 메쏘드를 이용해 데이타 이벤트를 등록합니다.</p>
<p>가지고 온 article들은 상태(state)값에 등록하기 위해 생성자 함수에 먼저 상태값을 등록해 둡니다.</p>
<pre><code>this.state = {  
articles:\[\]  
}
</code></pre><p>ComponentWillMount와 componentWillUnmount 값을 정의합니다.</p>
<pre><code>componentWillMount() {  
//데이터 조회 이벤트를 등록합니다.  
this.dao.list(25).on(&apos;value&apos;,(dataSnapshots)=\&gt;{  
var items = \[\];  
dataSnapshots.forEach(function(dataSnapshot){  
//..중략.. 테스트코드와 같게 작성합니다.  
})  
if(items &amp;&amp; items.length\&gt;0){  
// state값에 셋팅  
this.setState({  
articles: items.reverse()  
});  
}  
});  
}  
componentWillUnmount(){  
//이벤트 삭제  
this.dao.off();  
}
</code></pre><p>render 메쏘드에도 약간의 변화가 있습니다.<br>기존의 Editor 에 스프레스 함수를 설명하게 넘긴 수많은 속성(props)은 애플리케이션의 견고성을 위해 필요한 값만 넘기고 firebase에 저장된 목록을 가져오는 작업을 해 보겠습니다.</p>
<p>HTML 에서 목록을 의미하는 태그는 UL, OL입니다. 그 태그를 이용해서 render내의 jsx 는 아래와 같이 작업해 줍니다.</p>
<pre><code>Editor handleSubmit={this.submit} isAnonymous={this.isAnonymous}/\&gt;  
&lt;ul\&gt;  
{this.getArticles()}  
&lt;/ul\&gt;
</code></pre><p>getArticles 메쏘드는 Article의 상태를 가져오는 함수입니다.</p>
<pre><code>getArticles(){  
let lis = \[\];  
for(let i=0;i&lt;this.state.articles.length;i++){  
lis.push(&lt;li key={this.state.articles\[i\].key}\&gt;{this.state.articles\[i\].content}&lt;/li\&gt;);  
}  
return lis;  
}
</code></pre><p>이렇게 작성하고 나면 목록이 다음 [그림7]과 같이 완성됩니다.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*mC0OnTn1oW6V0k-RBNFEKA.jpeg" alt="">그림7</p>
<p>다음 번에는 이제 목록과 입력에 사용할 카드를 만들고 URL값을 어떻게 제대로 입력하는지 알아보도록 하겠습니다.</p>
<p>By <a href="https://medium.com/@keendev" target="_blank" rel="external">Keen Dev</a> on <a href="https://medium.com/p/d7173b5784d1" target="_blank" rel="external">November 7, 2016</a>.</p>
<p>Exported from <a href="https://medium.com" target="_blank" rel="external">Medium</a> on May 31, 2017.</p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/github-github-trend-tech-trend/">github, github-trend, tech-trend</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-[2016-11-07 14:16:13]서버리스 아키텍처 소셜미디어 개발기 3편"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="clearfix post-1016 post type-post status-publish format-standard has-post-thumbnail hentry category-template-2 category-uncategorized tag-codex tag-edge-case tag-featured-image tag-image tag-template">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2016/11/07/[2016-11-07 14:16:13]서버리스 아키텍처 소셜미디어 개발기 3편/">서버리스 아키텍처 소셜미디어 개발기 3편</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2016/11/07/[2016-11-07 14:16:13]서버리스 아키텍처 소셜미디어 개발기 3편/" class="article-date">
	  <time datetime="2016-11-07T05:16:13.000Z" itemprop="datePublished">11월 7, 2016</time>
	</a>

       
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="서버리스-아키텍처-소셜미디어-개발기-3편"><a href="#서버리스-아키텍처-소셜미디어-개발기-3편" class="headerlink" title="서버리스 아키텍처 소셜미디어 개발기 3편"></a>서버리스 아키텍처 소셜미디어 개발기 3편</h3><p>지난 번 글에서는 기초적인 편집기를 만드는 작업을 했습니다. 사용자 스토리에 기반한 하나의 편집기와 버튼으로만 구현할 수 있도록 화면을 구성했구요.</p>
<p><a href="https://techstory.shma.so/%EC%84%9C%EB%B2%84%EB%A6%AC%EC%8A%A4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98-%EC%86%8C%EC%85%9C%EB%AF%B8%EB%94%94%EC%96%B4-%EA%B0%9C%EB%B0%9C%EA%B8%B0-2%ED%8E%B8-3af179d28f73" title="https://techstory.shma.so/%EC%84%9C%EB%B2%84%EB%A6%AC%EC%8A%A4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98-%EC%86%8C%EC%85%9C%EB%AF%B8%EB%94%94%EC%96%B4-%EA%B0%9C%EB%B0%9C%EA%B8%B0-2%ED%8E%B8-3af179d28f73" target="_blank" rel="external"><strong>서버리스 아키텍처 소셜미디어 개발기 2편</strong><br>_지난 글에 이어 계속 됩니다._techstory.shma.so</a><a href="https://techstory.shma.so/%EC%84%9C%EB%B2%84%EB%A6%AC%EC%8A%A4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98-%EC%86%8C%EC%85%9C%EB%AF%B8%EB%94%94%EC%96%B4-%EA%B0%9C%EB%B0%9C%EA%B8%B0-2%ED%8E%B8-3af179d28f73" target="_blank" rel="external"></a></p>
<p>이번에는 Firebase를 본격적으로 다뤄보도록 하겠습니다.</p>
<h4 id="1-사용자-스토리2"><a href="#1-사용자-스토리2" class="headerlink" title="1. 사용자 스토리2"></a>1. 사용자 스토리2</h4><blockquote>
<p>김개발이 사이트를 방문해서 자신이 어제 유심하게 읽은 글을 올릴 수 있다. 이렇게 하면 다른 사람들이 볼 수 있다.<br>* 에디터 창은 하나만 있고 거기서 글을 작성하고 업로드 하면 글이 외부 클라우드 공간에 저장이 된다.</p>
</blockquote>
<p>이제는 사용자 스토리의 약간 디테일한 부분을 살펴보고그 부분에 대한 것들이 어떻게 더 풀어져 나가는지 살펴 보도록 하겠습니다.</p>
<blockquote>
<p>에디터 창은 하나만 있고 거기서 글을 작성하고 업로드 하면 글이 외부 클라우드 공간에 저장이 된다.</p>
</blockquote>
<p>왜 <strong><em>에디터 창은 하나만 있고</em></strong> 라는 표현을 썼을까요? 대부분의 소셜미디어들은 즉각적으로 남기고 싶은 말들을 남기고 업로드를 누르면 알아서 필요한 정보들을 이쁘게 만들어서 내어 줍니다. 그것과 유사하게 우리도 카드라는 형태를 만들어 볼 것인데, 일단 뒷쪽에 표현된 <strong><em>업로드 하면 글이 외부 클라우드 공간에 저장이 된다.</em></strong> 라는 데에 조금 더 관심을 기울여 만들어 보도록 하겠습니다.</p>
<h4 id="2-Firebase"><a href="#2-Firebase" class="headerlink" title="2. Firebase"></a>2. Firebase</h4><p>Firebase를 제가 처음 본 것은 Angular를 한참 공부하던 시절에 Todo App 기본 예제가 Firebase로 되어 있었습니다. 꽤 괜찮구나 하고 생각했는데 어느새 구글이 인수, 재작년 부터는 Google I/O의 주력 상품이 되어 있더군요.</p>
<p>일단 사이트를 방문해 볼까요?</p>
<p><a href="https://firebase.google.com/" title="https://firebase.google.com/" target="_blank" rel="external"><strong>Firebase | App success made simple</strong><br>_Firebase gives you the tools and infrastructure you need to build better apps and grow successful businesses._firebase.google.com</a><a href="https://firebase.google.com/" target="_blank" rel="external"></a></p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*pXsYDKQt-ZEG0MhVi6_yJA.png" alt=""></p>
<p>IBM의 cloudant, mongolab 같은 일종의 DBAAS(Database Aa A Service)라고 보시면 되는데 제공되는 혜택이나 서비스들이 워낙 막강해서 개발하면서 고민해야 하는 많은 부분들을 줄여줄 수 있습니다.</p>
<p>가장 큰 장점이라고 하는 부분들(자랑하고 있는 부분)은 분석과 개발 툴입니다. 확실히 대시보드는 깔끔하고 개발할때 언제나 필요했던 요소들을 sdk 로 제공해 주는데 대표적인 예로는 클라우드 메세징, 인증, 실시간 데이타베이스, 저장소, 호스팅, 원격구성, Test Lab, 오류 보고 입니다.</p>
<p>이 중에 우리가 사용할 녀석은 아무래도 인증과 실시간 데이타베이스 이 두가지 입니다. 서버리스 아키텍처를 지향하니까요~</p>
<p>구글 I/O의 처음부터 앱 만들기를 보시면 상당히 도움이 되실거 같구요. 하지만 이와 별개로 저도 처음부터 시작해 보도록 하겠습니다.</p>
<p><strong>가입</strong></p>
<p>가입은 Google ID가 있으면 가능합니다. 오른쪽 상단의 로그인 버튼을 누르고 로그인을 한뒤 로그인 버튼 옆에 있는 콘솔로 이동 버튼을 누릅니다.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*wh0GHuAOrbBQgTzpoYmXgg.png" alt=""></p>
<p>그럼 Console의 대문에 들어가게 되는데</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*E2ArLgqhtR5oW2fNm1CCFA.png" alt=""></p>
<p>거기서 새 프로젝트 만들기를 눌러서 새 프로젝트를 만들 수 있습니다.</p>
<p><strong>프로젝트 만들기</strong></p>
<p>다음과 같은 팝업창이 뜬 것을 확인할 수 있을 겁니다.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*Idq8jtAERbSrSTXSRRd5Zg.png" alt=""></p>
<p>프로젝트 이름을 StandUp, 국가/지역을 대한민국으로 설정하고 프로젝트 만들기 버튼을 클릭합니다.<br>그러고 나면 몇초 후에 다음과 같은 아름다운 대시보드 화면을 볼 수 있습니다.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*PSF6jlW_QGkQvWgaAMVMLg.png" alt=""></p>
<p>네! 이제 끝났습니다~ 개발에 필요한 부분이 나올 때에 Firebase 의 기능은 조금 더 설명하기로 하고 가장 중요한 한가지만 하고 작업을 진행하도록 하겠습니다.</p>
<p><strong>웹 앱에 Firebase 추가 </strong>버튼을 클릭하면 다음과 같은 창이 뜨는데 거기에 나온 config 값을 사용합니다.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*UDrHhQgNnOIpfy54vrKjXg.png" alt=""></p>
<h4 id="3-환경-설정"><a href="#3-환경-설정" class="headerlink" title="3. 환경 설정"></a><strong>3. 환경 설정</strong></h4><p>config.js 파일을 다음과 같이 만들어 줍니다.</p>
<pre><code>var config = {  
apiKey: process.env.REACT\_APP\_FIREBASE\_KEY,  
authDomain: process.env.REACT\_APP\_AUTH\_DOMAIN,  
databaseURL: process.env.REACT\_APP\_DB\_URL,  
storageBucket: process.env.REACT\_APP\_STRG\_BKT,  
messagingSenderId: process.env.REACT\_APP\_MSG\_SENDER\_ID  
}  
export default config;
</code></pre><p>여기서 두가지를 설명하고 가야할 것 같습니다. 첫번째는 process.env.으로 시작하는 값들입니다. create-react-app 설명을 찾아보시면 node에서 process.env에 들어가는 값을 관리하는 것을 이용해서process.env. REACT_APP_ 로 시작하게 되는 값들은 환경변수로 사용할 수 있습니다.</p>
<p>그렇다면 당연히 여러분이 같이 만드신 프로젝트 루트 디렉토리에 .env 파일을 만들고</p>
<pre><code>REACT\_APP\_FIREBASE\_KEY = &quot;AIzaSyCt6rkIrXNKr9xV0l-7Ei\_2m3vY6RlxdJ0&quot;  
REACT\_APP\_AUTH\_DOMAIN = &quot;standup-4125e.firebaseapp.com&quot;  
REACT\_APP\_DB\_URL= &quot;[https://standup-4125e.firebaseio.com][anchor4]&quot;  
REACT\_APP\_STRG\_BKT= &quot;standup-4125e.appspot.com&quot;  
REACT\_APP\_MSG\_SENDER\_ID= &quot;605830974241&quot;
</code></pre><p>와 같이 값을 만드시면 사용할 수 있습니다.</p>
<p>물론 API key 값들은 어느 정도 일정 시간이 지나면 제가 바꿀 것이기는 합니다. 값은 참조하시라고 남겨두었습니다.</p>
<p>이렇게 설정하고 나면 잘 가지고 오는지를 확인해 봐야겠지요?<br>App.js 같은 곳에 import 와 console 로그를 출력하는 소스를 집어 넣고 확인해 보도록 하겠습니다.</p>
<pre><code>import config from &apos;./config&apos;  
console.log(config.apiKey);
</code></pre><p>훌륭하게 출력이 되는 군요. 주의할 점 두가지는 create-react-app 의 react-scripts 버전이 0.5.0 이상이어야 하며 .env 에 등록한 변수는 꼭 node 서버를 재기동 시켜주셔야 인식 한다는 것입니다.</p>
<h4 id="4-HTML-편집기-작성"><a href="#4-HTML-편집기-작성" class="headerlink" title="4. HTML 편집기 작성"></a>4. HTML 편집기 작성</h4><p><img src="https://cdn-images-1.medium.com/max/1600/1*CcjCO1CbSbUWCgF5UjJM4g.png" alt=""></p>
<p>이제 기본적으로 HTML 편집기 에 들어갈 몇가지 유저스토리를 추가해서 작성해 보도록 하겠습니다.</p>
<blockquote>
<p>김개발이 사이트를 방문해서 자신이 어제 유심하게 읽은 글을 올릴 수 있다. 이렇게 하면 다른 사람들이 볼 수 있다.<br>* 에디터 창은 하나만 있고 거기서 글을 작성하고 업로드 하면 글이 외부 클라우드 공간에 저장이 된다.<br>* <strong>아무런 내용도 김개발이 입력하지 않으면 업로드하지 않는다.( 버튼이 눌러지지 않는다. )</strong></p>
</blockquote>
<p>유저 스토리에서 <strong>에디터 창은 하나만 </strong>있지만 개발을 하면서 데이타를 저렇게 저장할 수는 없을테니 어떻게 <strong>구조화 할지 </strong>고민을 일단 한번 해 보도록 합시다. 소셜미디어데 들어가는 데이타를 다시한번 생각해 보면 아래와 같은 형태로 구조화 되어 있지 않을까 확인할 수 있습니다.</p>
<pre><code>글 내용  
작성자  
URL  
--- 링크 타이틀  
--- 링크 요약  
--- 링크 이미지
</code></pre><p>글 내용은 사용자가 작성한 내용을 그대로 넣으면 되고, 작성자는 일단 Anonymous(겐지)로 지정하면 되는데 URL의 아래 내용은 어떻게 할까요? 관련 내용은 다음번에 조금더 기술하도록 하고 오늘은 일단 URL만 글 내용에서 분리하는 작업을 해 보겠습니다.</p>
<p>Editor.js 파일의 innerEdit 클래스에 이벤트를 한번 추가해 보도록 하겠습니다.</p>
<pre><code>&lt;div className=&quot;innerEdit&quot;  
contentEditable=&quot;true&quot;  
placeholder=&quot;글쓰기...&quot;  
onPaste={this.onPaste}  
onKeyUp={this.editorChange}\&gt;&lt;/div\&gt;
</code></pre><p>onKeyUp 이벤트는 URL을 입력하고 엔터나 스페이스를 쳤을 때 패턴 매칭을 통해 URL을 뽑아내고 onPaste 이벤트는 복사 붙여넣기 할때의 이벤트를 잡아내는 역할을 합니다.</p>
<pre><code>onPaste(event){  
event.clipboardData.items\[0\].getAsString(text=\&gt;{  
if(this.detectURL(text)){  
this.setState({embedlyUrl:text,content:this.state.content}});  
}  
})  
}  
editorChange(event){  
let checkText = this.detectURL(event.currentTarget.textContent);  
if(!this.state.embedlyUrl&amp;&amp;  
(event.keyCode===32||event.keyCode===13)&amp;&amp;  
checkText){  
this.setState({embedlyUrl:checkText,   
content:event.currentTarget.textContent});  
}else{  
this.setState({content:event.currentTarget.textContent});  
}  
}
</code></pre><p>onPaste와 editorChange는 모두 event 에서 값을 받지만 text 값을 얻어내는 방법이 조금씩 다릅니다.<br>onPaste는 클립보드의 아이템에서 값을 getAsString이라는 함수를 통해 얻어내는데 콜백함수의 매개 변수로 화살함수를 사용했습니다.<br>(여러번 ES2015 문법에 대해서 설명을 드렸지만 화살함수는 this를 의도적으로 지정할 수 있고 실제 함수를 풀어 쓰면 다음과 같은 형태의 함수로 바꿀 수 있습니다.)</p>
<pre><code>onPaste(event){  
var that = this;  
event.clipboardData.items\[0\].getAsString(function(text){   
if(that.detectURL(text)){  
that.setState({embedlyUrl:text});  
}  
})  
}
</code></pre><p>그리고 onPaste와 editorChange 모두 편집기의 텍스트 값에 들어가는 URL을 받아서 state 값에 저장을 하는 역할을 하고 있습니다. 하지만 content에 들어가는 값을 얻어내는 과정은 두가지가 조금 다릅니다.<br>먼저 editorChange 함수는 엔터와 스페이스바를 입력했을때</p>
<pre><code>event.keyCode===32||event.keyCode===13
</code></pre><p>편집기의 값을 확인하는 한편 onPaste는 event의 클립보드에서 텍스트를 잡아내는 거라 데이타를 완성하는 부분이 다릅니다.</p>
<p>지금까지의 Editor.js 소스는 다음과 같습니다.</p>
<pre><code>class Editor extends Component {  
/\*사용되는 메쏘드들을 모두 this 로 사용할 수 있도록 바인딩 해 준다.\*/  
constructor(props){  
super(props);  
this.onPaste = this.onPaste.bind(this);  
this.editorChange = this.editorChange.bind(this);  
this.getCard = this.getCard.bind(this);  
this.hasValue = this.hasValue.bind(this);  
//embedlyUrl과 content로 분리해 준다. 사용자 추가 전  
this.state ={  
embedlyUrl : undefined,  
content : undefined  
}  
}  
// 복사 붙여넣기에 사용되는 이벤트를 다뤄준다.  
onPaste(event){  
//클립보드 아이템의 첫번째 배열에서 text 를 받는다.  
event.clipboardData.items\[0\].getAsString(text=\&gt;{  
//원래는 text가 String 형태인지 확인해 봐야하지만 getAsString이라 에러보다는 비정상 작동  
//이 이루어질 수 있다.  
// detectURL 이라는 dummy function 이 필요하다.  
if(detectURL(text)){  
//content 의 state는 이미 붙여진 상태 이후기 때문에 state를 그대로 가져와도 됨  
this.setState({embedlyUrl:text});  
}  
})  
}  
editorChange(event){  
// detectURL 이라는 dummy function 이 필요하다.  
let checkText = detectURL(event.currentTarget.textContent);  
if(!this.state.embedlyUrl&amp;&amp;  
(event.keyCode===32||event.keyCode===13)&amp;&amp;  
checkText){  
this.setState({embedlyUrl:checkText,content:event.currentTarget.textContent});  
}else{  
this.setState({content:event.currentTarget.textContent});  
}  
}  
//일단은 Dummy 함수가 필요하다.  
detectURL(text){  
return undefined;  
}  
render() {  
return (  
&lt;div className=&quot;wrapEditor&quot;\&gt;  
&lt;Profile isAnonymous={this.props.isAnonymous}/\&gt;  
&lt;div className=&quot;textEditor&quot;\&gt;  
&lt;div className=&quot;innerEdit&quot;  
contentEditable=&quot;true&quot;  
placeholder=&quot;글쓰기...&quot;  
onPaste={this.onPaste}  
onKeyUp={this.editorChange}\&gt;&lt;/div\&gt;  
&lt;/div\&gt;  
&lt;div className=&quot;actionBar&quot;\&gt;  
&lt;button className=&quot;upload&quot;  
onClick={this.props.submit}\&gt;&lt;span\&gt;스탠드업!&lt;/span\&gt;&lt;/button\&gt;  
&lt;/div\&gt;  
&lt;/div\&gt;  
);  
}  
}
</code></pre><p>하지만 공통적으로 어떤 URL을 찾아내는 작업의 경우는 detectURL이라는 공통함수를 만들어야 되겠군요. 지금은 dummy 함수 입니다.<br>아직까지는 이런 공통적인 함수나 로직 없이 진행해서 테스트코드에 대한 언급을 하지 않았지만 이번에는 언급을 하고 시작하고자 합니다.</p>
<h4 id="5-테스트-코드"><a href="#5-테스트-코드" class="headerlink" title="5. 테스트 코드"></a>5. 테스트 코드</h4><p><img src="https://cdn-images-1.medium.com/max/1600/1*ag7c2dQx1C35v8r5HUpg5g.png" alt=""></p>
<p>create-react-app 은 기본적으로 jest를 내장하고 있습니다. 그래서 jest를 이용하는 방법과 똑같이 작성하시면 됩니다.</p>
<ul>
<li>__tests__ 폴더아래에 있는 .js 파일</li>
<li>.test.js로 끝나는 파일</li>
<li>.spec.js로 끝나는 파일</li>
</ul>
<p>들은 기본적으로 테스트 파일로 인식하는데,</p>
<pre><code>$npm test
</code></pre><p>를 실행시키면 진행해 볼 수 있습니다.</p>
<p>먼저 App.js 가 잘 로딩이 되는지에 대해 src 폴더 아래 App.test.js 라는 파일을 만들어 보겠습니다.</p>
<pre><code>import React from &apos;react&apos;;  
import ReactDOM from &apos;react-dom&apos;;  
import App from &apos;./App&apos;;

it(&apos;renders without crashing&apos;, () =\&gt; {  
const div = document.createElement(&apos;div&apos;);  
ReactDOM.render(&lt;App /\&gt;, div);  
});
</code></pre><p>실행 결과는 다음과 같이 표현 됩니다.</p>
<pre><code>\&gt; standup@0.1.0 test /Users/SongGangho/dev/standup  
\&gt; react-scripts test --- env=jsdom  
No tests found related to files changed since last commit.  
Press \`a\` to run all tests, or run Jest with \` --- watchAll\`.

Watch Usage  
› Press a to run all tests.  
› Press o to only run tests related to changed files.  
› Press p to filter by a filename regex pattern.  
› Press q to quit watch mode.  
› Press Enter to trigger a test run.
</code></pre><blockquote>
<p>npm test를 실행시키면 기본적으로 실행을 하고 대기 모드로 들어가고 언제나 Watch Usage를 뱉습니다.<br>a 는 모든 테스트를 실행시켜주고, p는 정규식에 매치가 되는 filter로 테스트 케이스를 돌릴 수 있고q는 감지(watch)모드를 종료 시킵니다. 감지모드일 경우는 파일이 변하면 알아서 테스트 케이스를 변경합니다.</p>
</blockquote>
<p>저의 경우는 파일을 만들고 마지막 커밋을 하고파일에 변화가 없는 경우라 이렇게 표시가 되는군요.</p>
<p>기본적으로 커밋이 안된 내용에 대해서만 감지하고 있다가 반영을 하는 훌륭한 메커니즘을 가지고 있습니다.</p>
<p>하지만 파일을 약간 수정하고 나면 그걸 바로 실행시켜 줍니다. 아래와 같이 실행이 됩니다.</p>
<pre><code>PASS src/App.test.js  
✓ renders without crashing (22ms)

Test Summary  
› Ran all tests related to changed files.  
› 1 test passed (1 total in 1 test suite, run time 1.327s)
</code></pre><p>iTerm 같은데서는 PASS가 녹색으로 표시 되어 있습니다.</p>
<h4 id="6-detectURL"><a href="#6-detectURL" class="headerlink" title="6. detectURL"></a>6. detectURL</h4><p><img src="https://cdn-images-1.medium.com/max/1600/1*Fg26Zcv_tWh_Byx4iAo1xA.png" alt="">어딜보자</p>
<p>이제 컴포넌트가 잘 로딩되는지에 대한 테스트는 마쳤으니 한번 detectURL에 대한 테스트 코드를 작성해 보도록 하겠습니다.</p>
<p>일단 src 폴더 아래에 __tests__ 폴더를 만들고, 우리가 테스트할 Editor.js파일과 똑같은 이름의 Editor.js 파일을 아래와 같이 만듭니다.</p>
<p>이 때 첫번째 원칙은 에러가 나는 코드를 만드는 것이죠. 이미</p>
<pre><code>return undefined;
</code></pre><p>를 통해 코드를 만들어 놓았습니다. 이제는 테스트 코드를 아래와 같이 만들어 보겠습니다.</p>
<pre><code>//Editor.js  
import Editor from &apos;../Editor&apos;;  
let ed = new Editor;  
it(&apos;detect URL &apos;, () =\&gt; {  
expect(ed.detectURL(&quot;my [www.devpools.kr][anchor5] &quot;)).toEqual(&quot;[www.devpools.kr][anchor5]&quot;);  
});
</code></pre><p>어떤 text값이 들어 오더라도 URL을 반환을 해 주는데 여러개가 있을지라도 하나의 URL을 반환을 받는 테스트 코드를 짜 보았습니다.</p>
<p>이렇게 실행을 시키면</p>
<pre><code>PASS src/App.test.js  
FAIL src/\_\_tests\_\_/Editor.js  
● detect URL

expect(received).toEqual(expected)

Expected value to equal:  
&quot;[www.devpools.kr][anchor5]&quot;  
Received:  
&quot;undefined&quot;

Difference:

Comparing two different types of values:  
Expected: array  
Received: undefined

at Object.&lt;anonymous\&gt; (src/\_\_tests\_\_/Editor.js:4:44)

Test Summary  
› Ran all tests.  
› 1 test failed, 1 test passed (2 total in 2 test suites, run time 0.125s)
</code></pre><p>와 같이 나오고 PASS 는 녹색 FAIL은 빨강색으로 분리가 됩니다. 해석을 하면 [<a href="http://www.clien.net" target="_blank" rel="external">www.clien.net</a>] 을 기대했는데, undefined가 왔다. 라고 하는 군요.</p>
<p>그럼 일단 패스만 시켜보기 위해 다음과 같이 detectURL을 변경해 보겠습니다.</p>
<pre><code>detectURL(text){  
return &quot;[www.devpools.kr][anchor5]&quot;;  
}
</code></pre><p>이렇게 할 경우는 당연히</p>
<pre><code>PASS src/App.test.js  
PASS src/\_\_tests\_\_/Editor.js  
Test Summary  
› Ran all tests related to changed files.  
› 2 tests passed (2 total in 2 test suites, run time 0.096s)
</code></pre><p>모두 통과하게 됩니다.</p>
<p>자, 하지만 이렇게 해서는 모든 경우를 통과할 수는 없을 겁니다. 이런 텍스트를 잘 다루기 위해 많이 사용되는 방법이 정규식인데요. 아래의 test 케이스를 모두 통과하는 정규식을 한번 짜 볼까합니다.</p>
<pre><code>it(&apos;detect URL 1&apos;, () =\&gt; {  
expect(ed.detectURL(&quot;my [www.devpools.kr][anchor5] &quot;))   
.toEqual(&quot;[www.devpools.kr][anchor5]&quot;);  
});  
it(&apos;detect URL 2&apos;, () =\&gt; {  
expect(  
ed.detectURL(&quot;[http://www.devpools.kr][anchor5]는 [www.github.com][anchor7]이 궁금하다&quot;))  
.toEqual(&quot;[http://www.devpools.kr][anchor5]&quot;);  
});  
it(&apos;detect URL 3&apos;, () =\&gt; {  
expect(  
ed.detectURL(&quot;[www.github.com][anchor7]은 [http://www.devpools.kr][anchor5]이 전문가&quot;))  
.toEqual(&quot;[http://www.devpools.kr][anchor5]&quot;);  
});
</code></pre><p>1번은 그냥 하나를 확인하는 내용이고 2번과 3번은 텍스트 내의 URL 들을 모두 확인해 봐야 합니다. 하지만 URL의 경우는 http 로 시작하는 경우가 있고, 그냥 .net .com 같은 접미어로 끝나는 여러가지 경우가 있습니다. 이 모든 경우를 다 커버할 수 있는 내용의 정규식보다는 간단하게 http(혹은 https) 로 시작하는 패턴과 www 로 시작하는 패턴을 파악해서 배열로 반환하도록 해보겠습니다. 둘다 존재한다면 http 까지 전체 있는 URL을 먼저 반환하면 더 좋겠죠.</p>
<pre><code>detectURL(text){  
var urls = (text.match(/(https?:\\/\\/\[^\\s\]+)/g)||  
text.match(/([www.\[][anchor8]^\\s\]+)/g));  
if(urls.length\&gt;0) return urls\[0\];  
else return undefined;  
}
</code></pre><p>혹시 관련해서 좋은 정규식 패턴을 아시는 분이 계시면 답변 주시면 소스를 변경하겠습니다. 혹은 PU는 더 두팔벌려 환영하겠습니다.</p>
<p>위와 같은 소스를 반영을 했더니 npm test는 모두 녹색 PASS를 반환합니다.</p>
<pre><code>PASS src/App.test.js  
PASS src/\_\_tests\_\_/Editor.js  
Test Summary  
› Ran all tests.  
› 4 tests passed (4 total in 2 test suites, run time 0.106s)
</code></pre><h4 id="7-폼-제출하기-전에-고려할-사항"><a href="#7-폼-제출하기-전에-고려할-사항" class="headerlink" title="7. 폼 제출하기 전에 고려할 사항"></a>7. 폼 제출하기 전에 고려할 사항</h4><p><img src="https://cdn-images-1.medium.com/max/1600/1*-rReFlYYSnMnCzE30_qcxw.png" alt="">흠.. 다음 수는요.</p>
<p>이제 클라우드 서비스에 반영할 준비는 거의 끝나가는데요. 기본적으로 편집기에 있는 값을 던지기 전의 준비사항만 더 살펴 볼까요. 일단 편집기에 값이 있는지 없는지에 대한 확인을 해 봐야 할 거 같습니다.</p>
<p>편집기의 값이 존재하고 string 값이 들어왔을 때에만 제출하는 코드를 짜야할 것이라고 판단할 때 테스트 코드는 다음과 같이 정의를 하면</p>
<pre><code>it(&apos;hasValue 1&apos;,()=\&gt;{  
expect(ed.hasValue(1)).toEqual(false);  
});  
it(&apos;hasValue 2&apos;,()=\&gt;{  
expect(ed.hasValue(new Date)).toEqual(false);  
});  
it(&apos;hasValue 3&apos;,()=\&gt;{  
expect(ed.hasValue(&quot;1&quot;)).toEqual(true);  
});  
it(&apos;hasValue 4&apos;,()=\&gt;{  
expect(ed.hasValue()).toEqual(false);  
});  
it(&apos;hasValue 5&apos;,()=\&gt;{  
expect(ed.hasValue({})).toEqual(false);  
});  
it(&apos;hasValue 6&apos;,()=\&gt;{  
expect(ed.hasValue(\[\]\])).toEqual(false);  
});
</code></pre><p>실행 코드는 다음과 같습니다.</p>
<pre><code>hasValue(value){  
if((value &amp;&amp; (typeof value) === &quot;string&quot;))  
return (!value)?false:(value.trim()===&quot;&quot;?false:true);  
else return false;  
}
</code></pre><p>결과는 당연히</p>
<pre><code>PASS src/App.test.js  
PASS src/\_\_tests\_\_/Editor.js  
Test Summary  
› Ran all tests related to changed files.  
› 8 tests passed (8 total in 2 test suites, run time 0.092s)
</code></pre><p>와 같이 나옵니다</p>
<p>이제 다음번에는 firebase 를 이용한 입력과 조회를 해 봐야겠습니다.</p>
<p>지금까지의 Editor.js 소스는 다음과 같습니다.</p>
<p>설명하지 않은 함수 중에 getCard라는 함수가 있습니다. 이 함수는 나중에 편집기에 카드가 들어가는 모습을 보기 위해 URL이 들어갈 수 있도록 간단하게 설계해 두었습니다. Embed.ly 관련 내용이 들어갈때 가장 많은 설명이 들어갈 컴포넌트가 될 것입니다.</p>
<p>day3 에 관련된 소스는 아래에서 확인할 수 있습니다.</p>
<p><a href="https://github.com/ehrudxo/standup/tree/day3" title="https://github.com/ehrudxo/standup/tree/day3" target="_blank" rel="external"><strong>ehrudxo/standup</strong><br>_standup project for newbi_github.com</a><a href="https://github.com/ehrudxo/standup/tree/day3" target="_blank" rel="external"></a></p>
<p>혹은 git 명령어</p>
<pre><code>$git pull origin day3 &amp;&amp; git checkout day3
</code></pre><p>하시면 로칼에서 확인할 수 있습니다.</p>
<p>By <a href="https://medium.com/@keendev" target="_blank" rel="external">Keen Dev</a> on <a href="https://medium.com/p/4820c96df984" target="_blank" rel="external">November 7, 2016</a>.</p>
<p>Exported from <a href="https://medium.com" target="_blank" rel="external">Medium</a> on May 31, 2017.</p>

      
    </div>
    <footer class="entry-meta entry-footer">
      
      
  <span class="ico-tags"></span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/github-github-trend-tech-trend/">github, github-trend, tech-trend</a></li></ul>

      
    </footer>
    <hr class="entry-footer-hr">
  </div>
  
</article>

<!-- Table of Contents -->

  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/12/">Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><a class="page-number" href="/page/15/">15</a><span class="space">&hellip;</span><a class="page-number" href="/page/96/">96</a><a class="extend next" rel="next" href="/page/14/">Next</a>
  </nav>

</section>
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Connect With Us</h3>
    <div class="widget widget_athemes_social_icons">

    	<ul class="clearfix widget-social-icons">   
    	
   			<li><a href="https://github.com/ehrudxo" title="Github"><i class="fa fa-github" aria-hidden="true"></i></a></li> 

   		
   			<li><a href="https://twitter.com/iam_keen" title="Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a></li> 

   		
   			<li><a href="https://www.facebook.com/kt.doh" title="Facebook"><i class="fa fa-facebook" aria-hidden="true"></i></a></li> 

   		
   		</ul>


   		<!--
   		<ul class="clearfix widget-social-icons">   		
   		<li class="widget-si-twitter"><a href="http://twitter.com" title="Twitter"><i class="ico-twitter"></i></a></li> 
		<li class="widget-si-facebook"><a href="http://facebook.com" title="Facebook"><i class="ico-facebook"></i></a></li>
			<li class="widget-si-gplus"><a href="http://plus.google.com" title="Google+"><i class="ico-gplus"></i></a></li>
			<li class="widget-si-pinterest"><a href="http://pinterest.com" title="Pinterest"><i class="ico-pinterest"></i></a></li>
			<li class="widget-si-flickr"><a href="http://flickr.com" title="Flickr"><i class="ico-flickr"></i></a></li>
			<li class="widget-si-instagram"><a href="http://instagram.com" title="Instagram"><i class="ico-instagram"></i></a></li>
		</ul> -->

    </div>
  </div>


  
    
  <div class="widget_athemes_tabs">
    <ul id="widget-tab" class="clearfix widget-tab-nav">
      <li class="active"><a>Recent Posts</a></li>
    </ul>
    <div class="widget">
      <ul>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2017/08/03/tech-trend-03/">(tech-trend) 구루들이 찾는다는 테크 트렌드 - 유명 블로그와 소셜 유명인</a></h6>
              <span>8월 3, 2017</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2017/08/01/refactoring02/">ES2015 리팩토링 – 2. 빠레꽁(var let const)</a></h6>
              <span>8월 1, 2017</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2017/07/07/tech-trend-02/">(tech-trend) 구루들이 찾는다는 테크 트렌드 - 해커뉴스</a></h6>
              <span>7월 7, 2017</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2017/06/09/feedwordpress/">feedwordpress를 설치하다</a></h6>
              <span>6월 9, 2017</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2017/06/07/about-test/">헤드리스 크롬과 selenium2의 조합을 사용해 보자 with node</a></h6>
              <span>6월 7, 2017</span>
            </div>

          </li>
        
          <li class="clearfix">

            
              <div class="widget-entry-summary" style="margin: 0;">
            

              <h6 style="margin: 0;"><a href="/2017/05/31/tech-trend-01/">(tech-trend) 기술트렌드에 대한 블로깅을 시작하며</a></h6>
              <span>5월 31, 2017</span>
            </div>

          </li>
        
      </ul>
    </div>
  </div>

  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript-Refactoring/">JavaScript, Refactoring</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/atom-rss/">atom,rss</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chatbot-experience/">chatbot, experience</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github-github-trend-tech-trend/">github, github-trend, tech-trend</a><span class="tag-list-count">182</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tech-trend-hacker-news/">tech trend, hacker news</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tech-trend-social-media/">tech trend, social media</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web-test-test-suite-headless-chrome-selenium/">web test, test suite, headless chrome, selenium</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JavaScript-Refactoring/" style="font-size: 15px;">JavaScript, Refactoring</a> <a href="/tags/atom-rss/" style="font-size: 10px;">atom,rss</a> <a href="/tags/chatbot-experience/" style="font-size: 15px;">chatbot, experience</a> <a href="/tags/github-github-trend-tech-trend/" style="font-size: 20px;">github, github-trend, tech-trend</a> <a href="/tags/tech-trend-hacker-news/" style="font-size: 10px;">tech trend, hacker news</a> <a href="/tags/tech-trend-social-media/" style="font-size: 10px;">tech trend, social media</a> <a href="/tags/web-test-test-suite-headless-chrome-selenium/" style="font-size: 10px;">web test, test suite, headless chrome, selenium</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>

    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">8월 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">7월 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">6월 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">5월 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">3월 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">2월 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">1월 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">12월 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">11월 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">10월 2016</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">8월 2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">7월 2016</a><span class="archive-list-count">20</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">6월 2016</a><span class="archive-list-count">24</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">5월 2016</a><span class="archive-list-count">32</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">4월 2016</a><span class="archive-list-count">28</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">3월 2016</a><span class="archive-list-count">29</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">2월 2016</a><span class="archive-list-count">9</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>

    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    <footer id="footer" class="site-footer">
  

  <div class="clearfix container">
      <div class="site-info">
	      &copy; 2017 keen blog All Rights Reserved.
        
            <span id="busuanzi_container_site_uv">
              本站访客数<span id="busuanzi_value_site_uv"></span>人次  
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
            </span>
          
      </div>
      <div class="site-credit">
        Theme by <a href="https://github.com/iTimeTraveler/hexo-theme-hipaper" target="_blank">hipaper</a>
      </div>
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");

    wrapdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";
    contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("allheader").offsetHeight - document.getElementById("footer").offsetHeight + "px";


    <!-- headerblur min height -->
    
      var headerblur = document.getElementById("header-blur");
      headerblur.style.minHeight = window.getComputedStyle(document.getElementById("allheader"), null).height;
    
    
</script>
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>








	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js" async=""></script>
</body>
</html>
